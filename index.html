<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Home</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Google+Sans&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="https://ssl.gstatic.com/classroom/favicon.png">
<style>
body { font-family: "Google Sans", Arial, sans-serif; margin:0; padding:0; }
.category-list { max-height: 0; overflow: hidden; transition: max-height 0.35s ease, opacity 0.35s ease, margin 0.35s ease; opacity: 0; margin-top: 0; }
.category-list.open { opacity: 1; margin-top: 0.25rem; max-height: 500px; }
@keyframes shimmer {0%{background-position:-400px 0;}100%{background-position:400px 0;} }
.skeleton{position:relative;overflow:hidden;background-color:#e0e0e0;border-radius:4px;}
.skeleton::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:shimmer 4s infinite;}
/* Iframe Overlay */
#iframeOverlay {
  display: none;
  position: fixed;           /* stay in viewport */
  top: 64px;                 /* below header */
  right: 1rem;               /* small right margin */
  width: 400px;              /* default width */
  height: 300px;             /* default height */
  max-width: calc(100% - 2rem);  /* never exceed viewport */
  max-height: calc(100% - 4rem); /* leave space for header & bottom margin */
  z-index: 1000;
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  transition: transform 0.3s ease, opacity 0.3s ease, width 0.3s ease, height 0.3s ease;
}

#iframeOverlay iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* Iframe Toggle Button */
#iframeToggleBtn {
  position: fixed;       /* bottom-right corner */
  bottom: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: #1967d2;
  color: white;
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: grab;
  z-index: 1100;
  font-size: 16px;
  user-select: none;
  transition: transform 0.2s ease, background 0.2s ease;
}

#iframeToggleBtn:active {
  cursor: grabbing;
  transform: scale(0.95);
}

/* Responsive adjustments */
@media (max-width: 640px) {
  #iframeOverlay {
    width: calc(100% - 2rem);  /* full width minus margin */
    height: 250px;              /* slightly shorter for small screens */
    right: 1rem;
    bottom: 1rem;
  }
}
@media (max-height: 480px) {
  #iframeOverlay {
    height: calc(100% - 4rem);  /* ensure fits vertically */
    top: 2rem;
  }
}
.active-link{background-color:#d2e3fc;color:#1967d2;}
.sidebar-scale{transform:scale(1.05);transform-origin:top left;}
.category-header{font-weight:600;font-size:0.875rem;margin-top:0.5rem;margin-bottom:0.25rem;padding-left:0.75rem;color:#555;cursor:pointer;user-select:none;display:flex;justify-content:space-between;align-items:center;}
.enrolled-item{padding-left:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:4px;display:flex;align-items:center;gap:0.80rem;transition:background 0.15s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:0.875rem;}
.enrolled-item:hover{background-color:#e3f2fd;}
.favicon-img,.favicon-letter{width:20px;height:20px;flex-shrink:0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:600;color:#000;background:#cfd8dc;}
</style>
</head>
<body class="bg-[#f8fafc] min-h-screen flex">

<!-- Sidebar -->
<aside class="flex flex-col w-64 bg-white border-r border-gray-200 relative z-10 sidebar-scale">
  <header class="flex items-center gap-3 px-5 py-4 border-b border-gray-200">
    <button aria-label="Menu" class="text-gray-700 text-xl"><i class="fas fa-bars"></i></button>
    <img alt="Google Classroom icon" class="w-6 h-6 ml-2" src="https://www.gstatic.com/classroom/ic_product_classroom_144.png">
    <span class="text-gray-800 text-base font-normal select-none ml-2">Classroom</span>
  </header>
  <nav class="flex flex-col mt-4 px-2 space-y-1">
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-[#d2e3fc] text-[#1967d2] text-sm font-medium select-none" href="#"><i class="fas fa-home text-sm"></i> Home</a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none" href="#"><i class="far fa-calendar-alt text-sm"></i> Calendar</a>
    <button id="enrolledBtn" aria-expanded="false" class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none w-full" type="button">
      <i class="fas fa-graduation-cap text-sm"></i> Enrolled
      <i id="enrolledChevron" class="fas fa-chevron-down ml-auto text-xs transition-transform duration-200" style="transform: rotate(-90deg);"></i>
    </button>
    <div id="enrolledList" class="flex flex-col space-y-1 mt-1" style="display:none;">
      <div class="category">
        <div class="category-header">Games <i class="fas fa-chevron-down text-xs" style="transform: rotate(-90deg);"></i></div>
        <div class="category-list">
          <a id="nullLink" data-url="https://nullxiety.com/" class="enrolled-item"></a>
          <a id="totallyLink" data-url="https://weslack.com/" class="enrolled-item"></a>
          <a id="scienceLink" data-url="https://totallyscience.app/" class="enrolled-item"></a>
          <a id="gnLink" data-url="https://gn-math.github.io/" class="enrolled-item"></a>
          <a id="englishLink" data-url="https://www.julios.games/home" class="enrolled-item"></a>
        </div>
      </div>
      <div class="category">
        <div class="category-header">Browser+Games <i class="fas fa-chevron-down text-xs" style="transform: rotate(-90deg);"></i></div>
        <div class="category-list">
          <a id="browserLink" data-url="https://best-force-734.nowgg.me/" class="enrolled-item"></a>
          <a id="spaceLink" data-url="https://erbytes.host2go.net/" class="enrolled-item"></a>
          <a id="randomLink" data-url="https://study.info.north-kazakhstan.su/" class="enrolled-item"></a>
          <a id="utopia2Link" data-url="https://meta-games-proxies.crabdance.com/" class="enrolled-item"></a>
          <a id="utopia3Link" data-url="https://bombbombbombiran.ruhezeiter.ch/" class="enrolled-item"></a>
          <a id="utopiaLink" data-url="https://classroom.google.com.my.to/" class="enrolled-item"></a>
          <a id="utopiaLink" data-url="https://apply.freediddy.info/" class="enrolled-item"></a>
        </div>
      </div>
    </div>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none" href="#"><i class="far fa-folder text-sm"></i> Archived classes</a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none" href="#"><i class="fas fa-cog text-sm"></i> Setting<span class="text-xs font-normal ml-auto">‚Ä∫</span></a>
  </nav>
</aside>

<!-- Main -->
<main class="flex-1 p-6 overflow-auto">
  <header class="flex items-center justify-end gap-6 mb-6">
    <button aria-label="Create" class="flex items-center justify-center w-8 h-8 text-gray-700 hover:bg-gray-200 rounded-full transition-colors duration-200">
      <svg aria-hidden="true" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"></path></svg>
    </button>
    <button aria-label="Apps" class="text-gray-700 font-light hover:bg-gray-200 rounded-full w-8 h-8 flex items-center justify-center">
      <svg aria-hidden="true" class="w-4 h-4" fill="#5f6368" viewBox="0 0 24 24"><circle cx="4.5" cy="4.5" r="2.5"/><circle cx="12" cy="4.5" r="2.5"/><circle cx="19.5" cy="4.5" r="2.5"/><circle cx="4.5" cy="12" r="2.5"/><circle cx="12" cy="12" r="2.5"/><circle cx="19.5" cy="12" r="2.5"/><circle cx="4.5" cy="19.5" r="2.5"/><circle cx="12" cy="19.5" r="2.5"/><circle cx="19.5" cy="19.5" r="2.5"/></svg>
    </button>
    <button id="profileBtn" aria-label="User profile" class="w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold select-none cursor-pointer" title="Click to change profile color/letter">
      <span id="profileLetter" class="text-sm leading-none"> </span>
    </button>
  </header>

  <section aria-label="Classroom cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    <script>
      for(let i=0;i<5;i++){
        document.write(`<article class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 flex flex-col justify-between min-h-[180px]">
          <div class="flex justify-between items-start mb-4">
            <div class="space-y-2 w-3/4">
              <div class="h-3 skeleton w-2/3"></div>
              <div class="h-3 skeleton w-1/2"></div>
            </div>
            <div class="rounded-full bg-gray-200 w-12 h-12 flex-shrink-0"></div>
          </div>
          <hr class="border-gray-200 mb-3">
          <!-- votes section removed -->
        </article>`);
      }
    </script>
  </section>
</main>

<div id="iframeOverlay"><iframe src="" allowfullscreen allow="fullscreen"></iframe></div>
<div id="iframeToggleBtn" title="Show/Hide iframe">‚áÖ</div>

<div id="wikiModal" class="fixed inset-0 z-[1200] hidden items-center justify-center">
  <div id="wikiOverlay" class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
  <div id="wikiBox" class="relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-xl p-6 transform scale-95 opacity-0 transition-all duration-300">
    <div class="flex justify-between items-center border-b pb-3 mb-4">
      <h2 class="text-lg font-semibold text-gray-800">üåê Web Proxy üåê</h2>
      <button id="closeWiki" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
    </div>
    <div class="flex flex-col md:flex-row gap-4 items-center justify-between mb-4">
      <label class="flex flex-col w-full md:w-1/2">
        <span class="text-sm font-semibold mb-1">Filter by Name</span>
        <select id="filter-name" class="rounded border-gray-300 p-2 focus:ring-blue-500">
          <option value="">All</option>
        </select>
      </label>
      <label class="flex flex-col w-full md:w-1/2">
        <span class="text-sm font-semibold mb-1">Filter by Date</span>
        <select id="filter-date" class="rounded border-gray-300 p-2 focus:ring-blue-500">
          <option value="today">Today</option>
          <option value="yesterday">Yesterday</option>
          <option value="last7">Last 7 Days</option>
          <option value="thisMonth">This Month</option>
          <option value="lastMonth">Last Month</option>
          <option value="thisYear">This Year</option>
          <option value="all" selected>All Time</option>
        </select>
      </label>
    </div>
    <div id="results" class="space-y-3 max-h-[50vh] overflow-y-auto"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const enrolledBtn=document.getElementById("enrolledBtn");
const enrolledList=document.getElementById("enrolledList");
const enrolledChevron=document.getElementById("enrolledChevron");
const iframeOverlay=document.getElementById("iframeOverlay");
const iframeEl=iframeOverlay.querySelector("iframe");
const iframeToggleBtn=document.getElementById("iframeToggleBtn");
const profileBtn=document.getElementById("profileBtn");
const profileLetter=document.getElementById("profileLetter");

// Select the "+" button at the top
const createBtn = document.querySelector('button[aria-label="Create"]');

// Toggle Minnit chat iframe
function toggleMinnitIframe() {
  if (iframeOverlay.style.display === "block" && iframeEl.src.includes("minnit.chat")) {
    // Just hide (don't unload)
    iframeOverlay.style.display = "none";
  } else {
    // Show Minnit chat
    iframeOverlay.style.display = "block";
    iframeEl.src = "https://organizations.minnit.chat/878547462864938/c/Main?embed&transparent";
    iframeToggleBtn.style.display = "none"; // hide the ‚áÖ for this iframe
    setEnrolled(false);
    document.querySelectorAll(".enrolled-item").forEach(l => l.classList.remove("active-link"));
  }
}

// Attach to "+"
createBtn.addEventListener("click", toggleMinnitIframe);

  
const supabase = window.supabase.createClient(
  'https://ylbeucokkfotgghbveuv.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlsYmV1Y29ra2ZvdGdnaGJ2ZXV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0MjU5MjksImV4cCI6MjA2MDAwMTkyOX0.EM52Z8YVA4xuCnNPLrAuweJq652QAPa3AjxjNRIrxE8'
);

const userId = localStorage.getItem('userId') || ('user_' + Math.random().toString(36).substr(2,9));
localStorage.setItem('userId', userId);

// Toggle enrolled
function setEnrolled(open){
  enrolledList.style.display=open?"flex":"none";
  enrolledBtn.setAttribute("aria-expanded",open);
  enrolledChevron.style.transform=open?"rotate(0deg)":"rotate(-90deg)";
}
enrolledBtn.addEventListener("click",()=>{setEnrolled(enrolledList.style.display==="none");});

// Profile persistence
const savedLetter=localStorage.getItem("profileLetter");
const savedColor=localStorage.getItem("profileColor");
if(savedLetter) profileLetter.textContent=savedLetter;
if(savedColor) profileBtn.style.backgroundColor=savedColor;

// Category expand/collapse
document.querySelectorAll('.category-header').forEach(h=>{
  const list=h.nextElementSibling;
  const icon=h.querySelector('i');
  icon.style.transform="rotate(-90deg)";
  h.addEventListener('click',()=>{
    const open=list.classList.toggle('open');
    icon.style.transform=open?"rotate(0deg)":"rotate(-90deg)";
  });
});

// Iframe open
function openIframe(linkEl,url){
  iframeOverlay.style.display="block";
  iframeEl.src=url;
  iframeToggleBtn.style.display="flex";
  setEnrolled(false);
  document.querySelectorAll(".enrolled-item").forEach(l=>l.classList.remove("active-link"));
  linkEl.classList.add("active-link");
}

// Smart favicon
function hashColor(str){let h=0;for(let i=0;i<str.length;i++)h=str.charCodeAt(i)+((h<<5)-h);const colors=["#ffd700","#f9d9c5","#e0e0e0","#add8e6","#cce0ff","#ffcce0","#d2e3fc"];return colors[Math.abs(h)%colors.length];}
async function smartFavicon(url,link){
  let domain;
  try{domain=new URL(url).origin;}catch{ return;}
  const img=document.createElement("img");
  img.className="favicon-img";
  img.alt="favicon";
  const trySources=[`https://www.google.com/s2/favicons?domain=${domain}&sz=32`, `${domain}/favicon.ico`];
  try {
    const resp=await fetch(url,{mode:"cors"});
    const html=await resp.text();
    const parser=new DOMParser();
    const doc=parser.parseFromString(html,"text/html");
    const icons=[...doc.querySelectorAll("link[rel*='icon']")];
    if(icons.length){
      const href=icons[0].getAttribute("href");
      if(href){const abs=new URL(href,domain).href;trySources.unshift(abs);}
    }
  } catch(e){}
  let i=0;
  function tryNext(){
    if(i>=trySources.length){
      const fallback=document.createElement("span");
      fallback.textContent=new URL(url).hostname.charAt(0).toUpperCase();
      fallback.className="favicon-letter";
      fallback.style.backgroundColor=hashColor(url);
      link.querySelector("img, span")?.remove();
      link.prepend(fallback);
      return;
    }
    img.src=trySources[i++];
  }
  img.onload=()=>{if(img.naturalWidth<16) tryNext(); else{link.querySelector("img, span")?.remove(); link.prepend(img);}};
  img.onerror=tryNext;
  tryNext();
}

// Load enrolled links and restore order after all items exist
async function loadEnrolledItems() {
  const links = document.querySelectorAll(".enrolled-item");

  for (const link of links) {
    const url = link.dataset.url;
    link.textContent = " " + (new URL(url).hostname.replace(/^www\./, ""));
    await smartFavicon(url, link);

    if (url.includes("julios.games")) {
      if (!link.querySelector("i")) {
        const icon = document.createElement("i");
        icon.className = "fas fa-external-link-alt ml-auto text-xs";
        link.append(icon);
      }
    }

    link.addEventListener("click", e => {
      e.preventDefault();
      const categoryList = link.parentElement;

      // Move clicked link to the top
      categoryList.prepend(link);

      // Save new order in localStorage
      const ids = Array.from(categoryList.querySelectorAll(".enrolled-item")).map(l => l.id);
      localStorage.setItem(`order_${categoryList.parentElement.querySelector(".category-header").textContent}`, JSON.stringify(ids));

      if (url.includes("julios.games")) {
        window.open(url, "_blank");
      } else {
        openIframe(link, url);
      }
    });
  }

  // Restore saved order AFTER all links are populated
  document.querySelectorAll(".category").forEach(cat => {
    const header = cat.querySelector(".category-header").textContent;
    const list = cat.querySelector(".category-list");
    const savedOrder = JSON.parse(localStorage.getItem(`order_${header}`) || "[]");
    if (savedOrder.length) {
      savedOrder.forEach(id => {
        const el = list.querySelector(`#${id}`);
        if (el) list.appendChild(el);
      });
    }
  });
}

// Initialize enrolled links
loadEnrolledItems();

  
// Toggle iframe
iframeToggleBtn.addEventListener("click",()=>{iframeOverlay.style.display=iframeOverlay.style.display==="none"?"block":"none";});

// Draggable iframe
let isDragging=false,dx=0,dy=0;
iframeToggleBtn.addEventListener("mousedown",e=>{isDragging=true;dx=e.clientX-iframeToggleBtn.offsetLeft;dy=e.clientY-iframeToggleBtn.offsetTop;iframeToggleBtn.style.cursor="grabbing";});
document.addEventListener("mousemove",e=>{if(!isDragging)return;iframeToggleBtn.style.left=`${e.clientX-dx}px`;iframeToggleBtn.style.top=`${e.clientY-dy}px`;});
document.addEventListener("mouseup",()=>{isDragging=false;iframeToggleBtn.style.cursor="grab";});

// WIKI-LINKS FETCH (votes removed, everything else intact)
const wikiModal = document.getElementById('wikiModal');
const wikiBox = document.getElementById('wikiBox');
const wikiOverlay = document.getElementById('wikiOverlay');
const closeWiki = document.getElementById('closeWiki');
const archivedBtn = [...document.querySelectorAll("a")].find(el => el.textContent.includes("Archived classes"));
let page = 0, pageSize = 5, currentFilter = { name: '', range: 'all' }, totalLinks = 0;

archivedBtn.addEventListener('click', () => {
  wikiModal.classList.remove('hidden');
  setTimeout(() => wikiBox.classList.add('scale-100', 'opacity-100'), 10);
  loadNames();
  applyFilters();
});
closeWiki.addEventListener('click', closeModal);
wikiOverlay.addEventListener('click', closeModal);
function closeModal() { wikiBox.classList.remove('scale-100','opacity-0'); setTimeout(()=>wikiModal.classList.add('hidden'),200); }

document.getElementById('filter-name').addEventListener('change', applyFilters);
document.getElementById('filter-date').addEventListener('change', applyFilters);

async function loadNames() {
  const { data } = await supabase.from('link_names').select('name');
  const select = document.getElementById('filter-name');
  select.innerHTML = `<option value="">All</option>`;
  data?.forEach(d => { const opt = document.createElement('option'); opt.value=d.name; opt.textContent=d.name; select.appendChild(opt); });
}

function getDateRange(rangeType) {
  const now=new Date(), start=new Date(), end=new Date();
  switch(rangeType){
    case 'today': start.setHours(0,0,0,0); return {start,end:now};
    case 'yesterday': start.setDate(start.getDate()-1); end.setDate(end.getDate()-1); start.setHours(0,0,0,0); end.setHours(23,59,59,999); return {start,end};
    case 'last7': start.setDate(start.getDate()-6); return {start,end:now};
    case 'thisMonth': start.setDate(1); return {start,end:now};
    case 'lastMonth': start.setMonth(start.getMonth()-1); start.setDate(1); end.setMonth(start.getMonth()); end.setDate(0); end.setHours(23,59,59,999); return {start,end};
    case 'thisYear': start.setMonth(0,1); start.setHours(0,0,0,0); return {start,end:now};
    default: return null;
  }
}

async function applyFilters() { page=0; currentFilter.name=document.getElementById('filter-name').value; currentFilter.range=document.getElementById('filter-date').value; await countTotalLinks(); await fetchLinks(); }

async function countTotalLinks() {
  let query = supabase.from('links').select('*', { count: 'exact', head: true });
  if(currentFilter.name) query = query.eq('name', currentFilter.name);
  const range=getDateRange(currentFilter.range);
  if(range) query=query.gte('date', range.start.toISOString().split('T')[0]).lte('date', range.end.toISOString().split('T')[0]);
  const { count }=await query; totalLinks=count||0;
}

async function fetchLinks() {
  const container=document.getElementById('results');
  container.innerHTML='';
  let query=supabase.from('links').select('*').order('date',{ascending:false}).range(page*pageSize,(page+1)*pageSize-1);
  if(currentFilter.name) query=query.eq('name',currentFilter.name);
  const range=getDateRange(currentFilter.range);
  if(range) query=query.gte('date', range.start.toISOString().split('T')[0]).lte('date', range.end.toISOString().split('T')[0]);
  const { data }=await query;
  if(!data||data.length===0){container.innerHTML=`<div class="text-center text-gray-500 py-4">‚ö†Ô∏è No links found.</div>`;return;}

  for(const link of data){
    const div=document.createElement('div');
    div.className='p-3 rounded-xl border hover:bg-gray-50 flex flex-col gap-1';
    div.innerHTML=`
      <a href="${link.url}" target="_blank" class="text-blue-600 hover:underline break-all font-medium">${link.name}</a>
      <span class="text-gray-500 text-xs break-all">${link.url}</span>
      <span class="text-gray-400 text-xs">${new Date(link.date).toLocaleDateString()}</span>
    `;
    container.appendChild(div);
  }
}
</script>
<!-- Login / Sign-Up Modal -->
<div id="authModal" class="fixed inset-0 z-[1300] hidden items-center justify-center">
  <div id="authOverlay" class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
  <div class="relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-md p-6 transform scale-95 opacity-0 transition-all duration-300">
    <div class="flex justify-between items-center border-b pb-3 mb-4">
      <h2 id="authTitle" class="text-lg font-semibold text-gray-800">Login</h2>
      <button id="closeAuthModal" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
    </div>
    <div class="flex flex-col gap-4">
      <input id="authEmail" type="email" placeholder="Email" class="border rounded px-3 py-2 w-full focus:ring-blue-500">
      <input id="authPassword" type="password" placeholder="Password" class="border rounded px-3 py-2 w-full focus:ring-blue-500">
      <button id="authActionBtn" class="bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors">Login</button>
      <span id="authMessage" class="text-red-500 text-sm"></span>
      <p class="text-sm text-gray-600 mt-2">
        <span id="toggleAuth" class="text-blue-600 hover:underline cursor-pointer">Don't have an account? Sign Up</span>
      </p>
    </div>
  </div>
</div>

<script>
// AUTH MODAL SCRIPT
const authModal = document.getElementById('authModal');
const authOverlay = document.getElementById('authOverlay');
const closeAuthModal = document.getElementById('closeAuthModal');
const authTitle = document.getElementById('authTitle');
const authEmail = document.getElementById('authEmail');
const authPassword = document.getElementById('authPassword');
const authActionBtn = document.getElementById('authActionBtn');
const authMessage = document.getElementById('authMessage');
const toggleAuth = document.getElementById('toggleAuth');

let isLogin = true; // Toggle between login and signup

function openAuthModal() {
  authModal.classList.remove('hidden');
  setTimeout(() => authModal.querySelector('div.relative').classList.add('scale-100','opacity-100'), 10);
}

function closeAuth() {
  const modalContent = authModal.querySelector('div.relative');
  modalContent.classList.remove('scale-100','opacity-0');
  setTimeout(() => authModal.classList.add('hidden'), 200);
  authMessage.textContent = '';
  authEmail.value = '';
  authPassword.value = '';
}

// Open modal on double-click profile button
profileBtn.addEventListener('dblclick', openAuthModal);
closeAuthModal.addEventListener('click', closeAuth);
authOverlay.addEventListener('click', closeAuth);

// Toggle Login / Sign-Up
toggleAuth.addEventListener('click', () => {
  isLogin = !isLogin;
  if (isLogin) {
    authTitle.textContent = 'Login';
    authActionBtn.textContent = 'Login';
    toggleAuth.textContent = "Don't have an account? Sign Up";
  } else {
    authTitle.textContent = 'Sign Up';
    authActionBtn.textContent = 'Sign Up';
    toggleAuth.textContent = "Already have an account? Login";
  }
  authMessage.textContent = '';
});

// Handle Auth (Login / Sign-Up)
authActionBtn.addEventListener('click', async () => {
  const email = authEmail.value.trim();
  const password = authPassword.value.trim();

  if (!email || !password) {
    authMessage.textContent = 'Please enter email and password';
    return;
  }

  if (isLogin) {
    // LOGIN
    const { data: user, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) authMessage.textContent = error.message;
    else { authMessage.textContent = 'Logged in successfully!'; closeAuth(); console.log('User:', user); }
  } else {
    // SIGN-UP
    const { data, error } = await supabase.auth.signUp({ email, password });
    if (error) authMessage.textContent = error.message;
    else { 
      authMessage.textContent = 'Account created! Please check your email to confirm.';
      authEmail.value = '';
      authPassword.value = '';
    }
  }
});
</script>
</body>
</html>
