<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlareLink - Infinite Unblocked Links</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Reset and base */
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: #0a0a0f;
      font-family: 'Inter', sans-serif;
      color: #eee;
      overflow: hidden;
    }
    #app {
      display: flex;
      height: 100vh;
      width: 100vw;
      flex-direction: row;
      backdrop-filter: none;
    }
    /* Sidebar */
    nav {
      background: rgba(20, 18, 34, 0.8);
      width: 72px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
      border-right: 1px solid #2c2a42;
      backdrop-filter: blur(15px);
      z-index: 10;
    }
    nav button {
      background: transparent;
      border: none;
      color: #999;
      margin: 0.7rem 0;
      cursor: pointer;
      transition: color 0.2s ease;
      font-size: 1.25rem;
    }
    nav button:hover, nav button:focus {
      color: #8b5cf6;
      outline: none;
    }
    nav img.logo {
      width: 36px;
      height: 36px;
      margin-bottom: 1rem;
      border-radius: 8px;
      cursor: default;
      user-select: none;
    }

    /* Main area */
    main {
      flex: 1;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 1.5rem 2rem;
      backdrop-filter: none;
    }

    /* Search bar */
    .search-bar {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      width: min(95vw, 480px);
      background: rgba(30, 25, 50, 0.4);
      backdrop-filter: blur(14px);
      border-radius: 9999px;
      border: 1px solid #6b21a8;
      display: flex;
      align-items: center;
      padding: 0.5rem 1rem;
      gap: 0.75rem;
      color: #ccc;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      z-index: 15;
    }
    .search-bar:focus-within {
      border-color: #a78bfa;
      color: #eee;
    }
    .search-bar input {
      flex: 1;
      background: transparent;
      border: none;
      color: #eee;
      font-size: 1rem;
      outline: none;
      font-weight: 500;
    }
    .search-bar button {
      background: transparent;
      border: none;
      color: #ccc;
      cursor: pointer;
      font-size: 1.15rem;
      transition: color 0.2s ease;
    }
    .search-bar button:hover {
      color: #a78bfa;
    }

    /* Cards grid */
    .cards-grid {
      margin-top: 5rem;
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(120px,1fr));
      gap: 1.25rem;
      width: 100%;
      max-width: 960px;
      z-index: 12;
    }
    .card {
      background: rgba(255 255 255 / 0.05);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 0 8px rgb(135 85 239 / 0.3);
      backdrop-filter: blur(16px);
      cursor: pointer;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition:
        box-shadow 0.3s ease,
        background-color 0.3s ease;
      position: relative;
    }
    .card:hover {
      background: rgba(255 255 255 / 0.15);
      box-shadow: 0 0 15px #8b5cf6aa;
    }
    .card .favicon {
      width: 56px;
      height: 56px;
      margin-bottom: 0.8rem;
      border-radius: 14px;
      background: #222;
      object-fit: contain;
      filter: drop-shadow(0 0 4px #7c3aedaa);
    }
    .card .label {
      font-weight: 600;
      font-size: 1.1rem;
      text-align: center;
      color: #ddd;
      user-select: none;
    }

    /* Iframe container & controls */
    .iframe-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(10,10,15,0.98);
      backdrop-filter: blur(18px);
      display: flex;
      flex-direction: column;
      z-index: 50;
    }
    .iframe-header {
      height: 48px;
      background: rgba(30, 20, 50, 0.8);
      backdrop-filter: blur(20px);
      display: flex;
      align-items: center;
      padding: 0 1rem;
      gap: 0.75rem;
      user-select: none;
    }
    .iframe-header button {
      border: none;
      background: rgba(255 255 255 / 0.1);
      border-radius: 8px;
      width: 36px;
      height: 36px;
      cursor: pointer;
      color: #ddd;
      font-size: 1.2rem;
      transition: background-color 0.25s ease;
    }
    .iframe-header button:hover {
      background: rgba(255 255 255 / 0.25);
    }
    .iframe-header .title {
      flex: 1;
      color: #ccc;
      font-weight: 600;
      font-size: 1.1rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    iframe {
      flex: 1;
      border: none;
      width: 100%;
      background: #0a0a0f;
    }

    /* Particles canvas */
    #particles-js {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
      pointer-events: none;
    }

    /* Scrollbar hidden for better look */
    ::-webkit-scrollbar {
      display: none;
    }
    scrollbar-width: none; /* Firefox */
  </style>
</head>
<body>

<div id="particles-js"></div>

<div id="app">
  <nav aria-label="Sidebar">
    <img src="https://storage.googleapis.com/a1aa/image/53f27051-c4bf-41e5-eab6-ee4e83df519e.jpg" alt="Logo" class="logo" draggable="false" />
    <!-- You can add sidebar buttons here if you want -->
  </nav>

  <main>
    <div class="search-bar" role="search">
      <input type="text" placeholder="Search FlareLink..." aria-label="Search FlareLink" id="search-input" autocomplete="off" spellcheck="false" />
      <button aria-label="Search" id="search-btn"><i class="fas fa-search"></i></button>
    </div>

    <div class="cards-grid" id="cards-container" aria-live="polite" aria-relevant="additions removals"></div>
  </main>
</div>

<!-- Iframe overlay -->
<div class="iframe-overlay" id="iframe-overlay" hidden>
  <div class="iframe-header">
    <button id="close-btn" aria-label="Close iframe"><i class="fas fa-times"></i></button>
    <button id="refresh-btn" aria-label="Refresh iframe"><i class="fas fa-redo"></i></button>
    <div class="title" id="iframe-title" title=""></div>
  </div>
  <iframe id="iframe" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock"></iframe>
</div>

<!-- FontAwesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<!-- Particles.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<script>
(() => {
  // Domains & service wildcards mapping
  const cardsData = [
    { id: 'space', label: 'Space', wildcard: '*.space', domains: [
      'blocksi.lol', 'deltamath.icu', 'desmosgraphing.xyz', 'desmos.lol',
      'edpuzzle.icu', 'goguardian.pro', 'googledrive.icu', 'nearpod.lol',
      'prodigy.it.com', 'stayinschooleducation.org', 'studentvue.my'
    ]},
    { id: 'daydreamx', label: 'DaydreamX', wildcard: '*.ddx', domains: [
      'blocksi.lol', 'deltamath.icu', 'desmosgraphing.xyz', 'desmos.lol',
      'edpuzzle.icu', 'goguardian.pro', 'googledrive.icu', 'nearpod.lol',
      'stayinschooleducation.org', 'studentvue.my'
    ]},
    { id: 'terbium', label: 'Terbium OS', wildcard: '*.tb', domains: [
      'blocksi.lol', 'deltamath.icu', 'desmosgraphing.xyz', 'desmos.lol',
      'edpuzzle.icu', 'goguardian.pro', 'googledrive.icu', 'nearpod.lol',
      'stayinschooleducation.org', 'studentvue.my'
    ]},
    { id: 'nebula', label: 'Nebula', wildcard: '*.nb', domains: [
      'blocksi.lol', 'deltamath.icu', 'desmosgraphing.xyz', 'desmos.lol',
      'edpuzzle.icu', 'goguardian.pro', 'googledrive.icu', 'nearpod.lol',
      'stayinschooleducation.org', 'studentvue.my'
    ]},
    { id: 'xen', label: 'Xen OS', wildcard: '*.xen', domains: [
      'blocksi.lol', 'deltamath.icu', 'desmosgraphing.xyz', 'desmos.lol',
      'edpuzzle.icu', 'goguardian.pro', 'googledrive.icu', 'nearpod.lol',
      'stayinschooleducation.org', 'studentvue.my'
    ]},
    { id: 'chatgpt', label: 'ChatGPT', wildcard: '', domains: [
      'chat.openai.com'
    ]},
  ];

  // Store recent cards order in localStorage key:
  const STORAGE_KEY = 'flarelink-recent-order';

  // Cached elements
  const cardsContainer = document.getElementById('cards-container');
  const iframeOverlay = document.getElementById('iframe-overlay');
  const iframe = document.getElementById('iframe');
  const iframeTitle = document.getElementById('iframe-title');
  const closeBtn = document.getElementById('close-btn');
  const refreshBtn = document.getElementById('refresh-btn');

  // Current card + iframe url state
  let currentCard = null;
  let currentIframeUrl = '';

  // Generate random string for subdomain
  function randomString(length = 6) {
    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
    let str = '';
    for (let i = 0; i < length; i++) {
      str += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return str;
  }

  // Generate iframe URL based on card and domain
  function generateIframeUrl(card) {
    // Special case ChatGPT: direct to chat.openai.com without wildcards
    if (card.id === 'chatgpt') {
      return `https://${card.domains[0]}`;
    }
    // For others, pick a random domain and generate wildcard subdomain
    const domain = card.domains[Math.floor(Math.random() * card.domains.length)];
    const subdomain = randomString(5);
    // Build URL:
    // wildcard format: subdomain.wildcard.domain.cdn.cloudflare.net
    // wildcard string example: *.space.blocksi.lol.cdn.cloudflare.net
    // The wildcard in cardsData is like '*.space', so remove '*' and prepend subdomain
    const wildcardPart = card.wildcard.replace('*', subdomain);
    return `https://${wildcardPart}.${domain}.cdn.cloudflare.net`;
  }

  // Smart favicon fetch with multiple methods fallback
  async function fetchFavicon(domain) {
    // Try favicon.ico at root first
    const faviconUrls = [
      `https://${domain}/favicon.ico`,
      `https://www.google.com/s2/favicons?domain=${domain}`,
      `https://icons.duckduckgo.com/ip3/${domain}.ico`,
      `https://www.google.com/s2/favicons?sz=64&domain_url=${domain}`
    ];

    for (const url of faviconUrls) {
      try {
        // Test if image loads successfully by creating Image element and awaiting load/error
        await new Promise((resolve, reject) => {
          const img = new Image();
          img.src = url;
          img.onload = () => resolve(true);
          img.onerror = () => reject(false);
        });
        return url; // first successful favicon url
      } catch {}
    }
    return 'https://via.placeholder.com/64?text=?'; // fallback blank icon
  }

  // Save recent card order to localStorage
  function saveOrder(order) {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(order));
    } catch (e) {
      // no-op
    }
  }

  // Load recent card order from localStorage or default
  function loadOrder() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        // Validate keys:
        if (Array.isArray(parsed) && parsed.every(id => cardsData.find(c => c.id === id))) {
          return parsed;
        }
      }
    } catch {}
    // default: order of cardsData
    return cardsData.map(c => c.id);
  }

  // Render cards with current order
  async function renderCards() {
    cardsContainer.innerHTML = '';
    const order = loadOrder();

    // Render in order: most recent left = first
    for (const cardId of order) {
      const card = cardsData.find(c => c.id === cardId);
      if (!card) continue;

      // Create card element
      const cardEl = document.createElement('div');
      cardEl.className = 'card';
      cardEl.setAttribute('role', 'button');
      cardEl.setAttribute('tabindex', '0');
      cardEl.setAttribute('aria-label', `Open ${card.label}`);
      cardEl.dataset.cardId = card.id;

      // Favicon (async fetch)
      const faviconUrl = await fetchFavicon(card.domains[0]);
      const img = document.createElement('img');
      img.className = 'favicon';
      img.alt = `${card.label} favicon`;
      img.draggable = false;
      img.src = faviconUrl;
      cardEl.appendChild(img);

      // Label
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = card.label;
      cardEl.appendChild(label);

      // Click and keyboard handlers
      cardEl.addEventListener('click', () => openCard(card));
      cardEl.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openCard(card);
        }
      });

      cardsContainer.appendChild(cardEl);
    }
  }

  // Open a card iframe and reorder cards (move clicked to leftmost)
  function openCard(card) {
    currentCard = card;
    loadIframe(card);

    // Update order: move card.id to front
    let order = loadOrder();
    order = order.filter(id => id !== card.id);
    order.unshift(card.id);
    saveOrder(order);
    renderCards();

    // Show overlay
    iframeOverlay.hidden = false;
  }

  // Load iframe with generated url for current card
  function loadIframe(card) {
    currentIframeUrl = generateIframeUrl(card);
    iframe.src = currentIframeUrl;
    iframeTitle.textContent = card.label + ' â€” ' + currentIframeUrl;
    iframeTitle.title = currentIframeUrl;
  }

  // Close iframe overlay
  function closeIframe() {
    iframe.src = 'about:blank';
    iframeOverlay.hidden = true;
    currentCard = null;
    currentIframeUrl = '';
  }

  // Refresh iframe (generate new url and reload)
  function refreshIframe() {
    if (!currentCard) return;
    loadIframe(currentCard);
  }

  // Setup event listeners
  closeBtn.addEventListener('click', closeIframe);
  refreshBtn.addEventListener('click', refreshIframe);

  // Keyboard shortcut: Escape closes iframe
  window.addEventListener('keydown', e => {
    if (e.key === 'Escape' && !iframeOverlay.hidden) {
      closeIframe();
    }
  });

  // Search box (just filter cards by label, fast local filtering)
  const searchInput = document.getElementById('search-input');
  searchInput.addEventListener('input', () => {
    const filter = searchInput.value.toLowerCase().trim();
    [...cardsContainer.children].forEach(cardEl => {
      const label = cardEl.querySelector('.label').textContent.toLowerCase();
      cardEl.style.display = label.includes(filter) ? '' : 'none';
    });
  });

  // Particle background config
  particlesJS('particles-js', {
    "particles": {
      "number": {
        "value": 45,
        "density": { "enable": true, "value_area": 900 }
      },
      "color": { "value": "#8b5cf6" },
      "shape": { "type": "circle" },
      "opacity": {
        "value": 0.2,
        "random": true
      },
      "size": {
        "value": 4,
        "random": true
      },
      "move": {
        "enable": true,
        "speed": 1.2,
        "direction": "none",
        "random": true,
        "straight": false,
        "out_mode": "bounce",
        "bounce": true
      }
    },
    "interactivity": {
      "detect_on": "canvas",
      "events": {
        "onhover": { "enable": false },
        "onclick": { "enable": false }
      }
    },
    "retina_detect": true
  });

  // Initialize
  renderCards();
})();
</script>

</body>
</html>
