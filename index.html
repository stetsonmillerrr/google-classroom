<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Home</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Google+Sans&display=swap" rel="stylesheet">

<!-- Favicon -->
<link rel="icon" type="image/png" href="https://ssl.gstatic.com/classroom/favicon.png">

<style>
body { font-family: "Google Sans", Arial, sans-serif; margin:0; padding:0; }
@keyframes shimmer {0%{background-position:-400px 0;}100%{background-position:400px 0;} }
.skeleton{position:relative;overflow:hidden;background-color:#e0e0e0;border-radius:4px;}
.skeleton::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:shimmer 4s infinite;}
#iframeOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;background:white;}
#iframeOverlay iframe{width:100%;height:100%;border:none;}
#iframeToggleBtn{position:fixed;bottom:20px;left:20px;width:40px;height:40px;background:#1967d2;color:white;border-radius:9999px;display:flex;align-items:center;justify-content:center;cursor:grab;z-index:1100;font-size:16px;user-select:none; display:none;}
#iframeToggleBtn:active{cursor:grabbing;}
.active-link{background-color:#d2e3fc;color:#1967d2;}
.sidebar-scale{transform:scale(1.05);transform-origin:top left;}

/* Category styles */
.category-block { margin-bottom: 8px; }
.category-title { 
  font-size: 0.75rem; 
  font-weight: 700; 
  color: #555; 
  padding-left: 12px; 
  text-transform: uppercase; 
  margin-bottom: 2px;
}
.category-divider { 
  border-top: 1px solid #cfd8dc; 
  margin: 2px 8px 6px 8px;
}
.enrolled-item { 
  padding-left: 20px; 
  padding-top: 4px; 
  padding-bottom: 4px; 
  border-radius: 4px; 
  display: flex; 
  align-items: center; 
  gap: 6px;
  transition: background 0.15s;
}
.enrolled-item:hover { 
  background-color: #e3f2fd; 
}
</style>
</head>
<body class="bg-[#f8fafc] min-h-screen flex">

<!-- Sidebar -->
<aside class="flex flex-col w-64 bg-white border-r border-gray-200 relative z-10 sidebar-scale">
  <header class="flex items-center gap-3 px-5 py-4 border-b border-gray-200">
    <button aria-label="Menu" class="text-gray-700 text-xl"><i class="fas fa-bars"></i></button>
    <img alt="Google Classroom icon" class="w-6 h-6 ml-2" src="https://www.gstatic.com/classroom/ic_product_classroom_144.png">
    <span class="text-gray-800 text-base font-normal select-none ml-2">Classroom</span>
  </header>
  <nav class="flex flex-col mt-4 px-2 space-y-1">
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-[#d2e3fc] text-[#1967d2] text-sm font-medium select-none" href="#"><i class="fas fa-home text-sm"></i> Home</a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none" href="#"><i class="far fa-calendar-alt text-sm"></i> Calendar</a>

    <!-- Enrolled toggle -->
    <button id="enrolledBtn" aria-expanded="false" class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none w-full" type="button">
      <i class="fas fa-graduation-cap text-sm"></i> Enrolled
      <i id="enrolledChevron" class="fas fa-chevron-down ml-auto text-xs transition-transform duration-200" style="transform: rotate(-90deg);"></i>
    </button>

    <!-- Enrolled list with categories -->
    <div id="enrolledList" class="flex flex-col mt-1" style="display: none;">
      <!-- Games -->
      <div class="category-block">
        <div class="category-title">Games</div>
        <hr class="category-divider">
        <a id="duckLink" data-url="https://duck.quackprep.com/" class="enrolled-item"></a>
        <a id="englishLink" data-url="https://www.julios.games/home" class="enrolled-item"></a>
      </div>
      <!-- Science -->
      <div class="category-block">
        <div class="category-title">Science</div>
        <hr class="category-divider">
        <a id="scienceLink" data-url="https://intrinsic.observer/" class="enrolled-item"></a>
        <a id="spaceLink" data-url="https://nasa.gov/" class="enrolled-item"></a>
      </div>
      <!-- History -->
      <div class="category-block">
        <div class="category-title">History</div>
        <hr class="category-divider">
        <a id="worldHistoryLink" data-url="https://wfdxcajxzt.lawsonengineers.co.uk/" class="enrolled-item"></a>
        <a id="usHistoryLink" data-url="https://edpuzzle.com.de/" class="enrolled-item"></a>
      </div>
      <!-- Math -->
      <div class="category-block">
        <div class="category-title">Math</div>
        <hr class="category-divider">
        <a id="healthLink" data-url="https://gn-math.github.io/" class="enrolled-item"></a>
      </div>
    </div>

    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none" href="#"><i class="far fa-folder text-sm"></i> Archived classes</a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 text-sm font-normal hover:bg-gray-100 select-none" href="#"><i class="fas fa-cog text-sm"></i> Setting<span class="text-xs font-normal ml-auto">›</span></a>
  </nav>
</aside>

<!-- Main content -->
<main class="flex-1 p-6 overflow-auto">
  <!-- Top bar -->
  <header class="flex items-center justify-end gap-6 mb-6">
    <button aria-label="Create" class="flex items-center justify-center w-8 h-8 text-gray-700 hover:bg-gray-200 rounded-full transition-colors duration-200">
      <svg aria-hidden="true" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"></path></svg>
    </button>
    <button aria-label="Apps" class="text-gray-700 font-light hover:bg-gray-200 rounded-full w-8 h-8 flex items-center justify-center">
      <svg aria-hidden="true" class="w-4 h-4" fill="#5f6368" viewBox="0 0 24 24"><circle cx="4.5" cy="4.5" r="2.5"/><circle cx="12" cy="4.5" r="2.5"/><circle cx="19.5" cy="4.5" r="2.5"/><circle cx="4.5" cy="12" r="2.5"/><circle cx="12" cy="12" r="2.5"/><circle cx="19.5" cy="12" r="2.5"/><circle cx="4.5" cy="19.5" r="2.5"/><circle cx="12" cy="19.5" r="2.5"/><circle cx="19.5" cy="19.5" r="2.5"/></svg>
    </button>
    <button id="profileBtn" aria-label="User profile" class="w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold select-none cursor-pointer" title="Click to change profile color/letter">
      <span id="profileLetter" class="text-sm leading-none">A</span>
    </button>
  </header>

  <!-- Classroom cards -->
  <section aria-label="Classroom cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    <script>
      for(let i=0;i<5;i++){
        document.write(`<article class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 flex flex-col justify-between min-h-[180px]">
          <div class="flex justify-between items-start mb-4">
            <div class="space-y-2 w-3/4">
              <div class="h-3 skeleton w-2/3"></div>
              <div class="h-3 skeleton w-1/2"></div>
            </div>
            <div class="rounded-full bg-gray-200 w-12 h-12 flex-shrink-0"></div>
          </div>
          <hr class="border-gray-200 mb-3">
          <div class="flex justify-between items-center text-gray-400 text-xs">
            <div class="flex gap-2">
              <input disabled type="checkbox" class="cursor-not-allowed">
              <input disabled type="checkbox" class="cursor-not-allowed">
            </div>
            <button class="text-gray-400 hover:text-gray-600"><i class="fas fa-ellipsis-v"></i></button>
          </div>
        </article>`);
      }
    </script>
  </section>
</main>

<!-- iframe overlay -->
<div id="iframeOverlay">
  <iframe src="" allowfullscreen allow="fullscreen"></iframe>
</div>

<!-- draggable toggle button -->
<div id="iframeToggleBtn" title="Show/Hide iframe">⇅</div>

<script>
// -------------------- Utility functions --------------------
function setEnrolled(open){
  enrolledList.style.display=open?"flex":"none";
  enrolledBtn.setAttribute("aria-expanded",open);
  enrolledChevron.style.transform=open?"rotate(0deg)":"rotate(-90deg)";
}
function hashColor(str){
  let hash=0; for(let i=0;i<str.length;i++) hash=str.charCodeAt(i)+((hash<<5)-hash);
  const colors=["#ffd700","#f9d9c5","#e0e0e0","#add8e6","#cce0ff","#ffcce0","#d2e3fc"];
  return colors[Math.abs(hash)%colors.length];
}
async function fetchTitle(url){
  const cacheKey="title:"+url;
  const cached=localStorage.getItem(cacheKey);
  if(cached) return cached;
  try{
    const res=await fetch(url,{mode:"cors"});
    const text=await res.text();
    const match=text.match(/<title[^>]*>([^<]+)<\/title>/i);
    if(match){
      const title=match[1].trim();
      localStorage.setItem(cacheKey,title);
      return title;
    }
  }catch(e){ console.warn("Title fetch failed",url); }
  return new URL(url).hostname;
}
function loadFavicon(link){
  const url=link.getAttribute("data-url");
  let domain; try{domain=new URL(url).hostname;}catch(e){return;}
  const sources=[
    `https://www.google.com/s2/favicons?domain=${domain}&sz=32`,
    `https://www.google.com/s2/favicons?sz=32&domain_url=${url}`,
    `${url.replace(/\/$/,"")}/favicon.ico`
  ];
  const img=document.createElement("img");
  img.className="w-5 h-5 rounded"; img.alt="favicon";
  let index=0;
  function tryNext(){
    if(index>=sources.length){
      const badge=document.createElement("span");
      badge.textContent=link.textContent.trim().charAt(0).toUpperCase();
      badge.className="flex items-center justify-center w-5 h-5 rounded-full text-xs font-semibold";
      badge.style.backgroundColor=hashColor(domain);
      badge.style.color="#000";
      link.prepend(badge);
      return;
    }
    img.src=sources[index++];
  }
  img.onerror=tryNext;
  img.onload=()=>{ if(img.naturalWidth<=16){ tryNext(); } else { 
    link.querySelector("img, span")?.remove();
    link.prepend(img);
  }};
  tryNext();
}

// -------------------- Elements --------------------
const enrolledBtn=document.getElementById("enrolledBtn");
const enrolledList=document.getElementById("enrolledList");
const enrolledChevron=document.getElementById("enrolledChevron");
const iframeOverlay=document.getElementById("iframeOverlay");
const iframeEl=iframeOverlay.querySelector("iframe");
const iframeToggleBtn=document.getElementById("iframeToggleBtn");

// -------------------- Enrolled toggle --------------------
enrolledBtn.addEventListener("click",()=>{setEnrolled(enrolledList.style.display==="none");});

// -------------------- Profile Icon logic --------------------
const profileBtn=document.getElementById("profileBtn");
const profileLetter=document.getElementById("profileLetter");
const savedLetter=localStorage.getItem("profileLetter");
const savedColor=localStorage.getItem("profileColor");
if(savedLetter) profileLetter.textContent=savedLetter;
if(savedColor) profileBtn.style.backgroundColor=savedColor;
profileBtn.addEventListener("click",()=>{
  const newLetter=prompt("Enter a new letter for profile icon:",profileLetter.textContent)||profileLetter.textContent;
  const newColor=prompt("Enter a new background color (hex or name):",profileBtn.style.backgroundColor)||profileBtn.style.backgroundColor;
  profileLetter.textContent=newLetter; profileBtn.style.backgroundColor=newColor;
  localStorage.setItem("profileLetter",newLetter); localStorage.setItem("profileColor",newColor);
});

// -------------------- Iframe logic --------------------
function openIframe(linkEl,url){
  iframeOverlay.style.display="block";
  iframeEl.src=url;
  iframeToggleBtn.style.display="flex";
  setEnrolled(false);
  enrolledList.prepend(linkEl);
  Array.from(enrolledList.querySelectorAll(".enrolled-item")).forEach(a=>a.classList.remove("active-link"));
  linkEl.classList.add("active-link");
  localStorage.setItem("enrolledOrder",JSON.stringify(Array.from(enrolledList.querySelectorAll(".enrolled-item")).map(a=>a.id)));
}

// -------------------- Restore order --------------------
const savedOrder=JSON.parse(localStorage.getItem("enrolledOrder")||"[]");
if(savedOrder.length) savedOrder.forEach(id=>{const el=document.getElementById(id);if(el) enrolledList.appendChild(el);});

// -------------------- Enhance enrolled links --------------------
document.querySelectorAll(".enrolled-item").forEach(async link=>{
  const url=link.getAttribute("data-url");
  link.classList.add("cursor-pointer");

  const title=await fetchTitle(url);
  link.textContent=" "+title;

  loadFavicon(link);

  link.addEventListener("click",e=>{
    e.preventDefault();
    if(link.id==="englishLink"){
      window.open(url,"_blank");
      enrolledList.prepend(link);
    } else {
      openIframe(link,url);
    }
  });
});

// -------------------- Toggle iframe --------------------
iframeToggleBtn.addEventListener("click",()=>{
  if(iframeOverlay.style.display==="none"){
    // Only show toggle if iframe open
    return;
  }
  iframeOverlay.style.display="none";
  iframeEl.src="";
  iframeToggleBtn.style.display="none";
});

// -------------------- Draggable toggle button --------------------
let isDragging=false, dragOffsetX=0, dragOffsetY=0;
iframeToggleBtn.addEventListener("mousedown", e => { isDragging=true; dragOffsetX=e.clientX-iframeToggleBtn.offsetLeft; dragOffsetY=e.clientY-iframeToggleBtn.offsetTop; iframeToggleBtn.style.cursor="grabbing"; });
document.addEventListener("mousemove", e => { if(!isDragging) return; iframeToggleBtn.style.left=`${e.clientX-dragOffsetX}px`; iframeToggleBtn.style.top=`${e.clientY-dragOffsetY}px`; });
document.addEventListener("mouseup",()=>{isDragging=false; iframeToggleBtn.style.cursor="grab";});
iframeOverlay.addEventListener("click", e => { if(e.target===iframeOverlay){ iframeOverlay.style.display="none"; iframeEl.src=""; iframeToggleBtn.style.display="none"; } });
</script>
</body>
</html>
